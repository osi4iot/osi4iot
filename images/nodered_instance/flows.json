[{"id":"9513dee04b284c5d","type":"debug","z":"f6f2187d.f17ca8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":290,"y":80,"wires":[]},{"id":"e3266d679786f303","type":"comment","z":"f6f2187d.f17ca8","name":"OSI4IOT MQTT Broker can be tested sending a message to the 'MQTT_TOPIC_TEST' topic.","info":"","x":330,"y":40,"wires":[]},{"id":"fac5b0ea09b71bcf","type":"mqtt in","z":"f6f2187d.f17ca8","name":"Mqtt topic test","topic":"MQTT_TOPIC_TEST","qos":"2","datatype":"utf8","broker":"6346b608.d007a8","nl":false,"rap":true,"rh":0,"inputs":0,"x":110,"y":80,"wires":[["9513dee04b284c5d"]]},{"id":"c1e389ddaaff80ce","type":"comment","z":"f6f2187d.f17ca8","name":"Initialization and reading Digital Twin Mqtt Topics in Group","info":"","x":230,"y":160,"wires":[]},{"id":"6084923855609b53","type":"inject","z":"f6f2187d.f17ca8","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":200,"wires":[["6a5f1c90087b4881"]]},{"id":"6a5f1c90087b4881","type":"function","z":"f6f2187d.f17ca8","name":"Initialization","func":"let dTMqttTopics = {};\ndTMqttTopics = global.get('dTMqttTopics') || {};\nmsg.payload = dTMqttTopics;\nreturn msg;","outputs":1,"timeout":"","noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is started.\n// Code added here will be run once\n// whenever the node is started.\nconst token = env.get(\"TOKEN\");\nconst groupId = env.get(\"GROUP_ID\");\nconst initialization = global.get(\"initialization\");\nconst getDTMqttTopics = global.get(\"getDTMqttTopics\");\n\nlet pyodide = global.get('pyodide', \"memory\") || null;\nlet pythonLibraries = global.get('pythonLibraries', \"memory\") || null;\nlet mlModels = global.get('mlModels', \"memory\") || null;\n\nnode.status({ fill: \"yellow\", shape: \"dot\", text: \"Initializing\" });\nif (token !== \"\" && groupId !== \"0\") {\n    const dTMqttTopics = await getDTMqttTopics();\n    global.set('dTMqttTopics', dTMqttTopics);\n}\nif (!pyodide || !pythonLibraries || !mlModels) {\n    [pyodide, pythonLibraries, mlModels] = await initialization(token, groupId)\n    global.set('pyodide', pyodide, \"memory\");\n    global.set('pythonLibraries', pythonLibraries, \"memory\");\n    global.set('mlModels', mlModels, \"memory\");\n    node.status({ fill: \"green\", shape: \"dot\", text: \"Ready\" })\n    const pyodideEmiter = global.get('pyodideEmiter');\n    pyodideEmiter.emit('pyodide_ready', 'Pyodide ready to be used.');\n} else {\n    node.status({ fill: \"green\", shape: \"dot\", text: \"Ready\" })\n}","finalize":"","libs":[],"x":310,"y":200,"wires":[["60df2ee92f458b58"]]},{"id":"60df2ee92f458b58","type":"debug","z":"f6f2187d.f17ca8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":490,"y":200,"wires":[]},{"id":"213a2e831c300cb2","type":"inject","z":"f6f2187d.f17ca8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":300,"wires":[["91968635033d903f"]]},{"id":"91968635033d903f","type":"function","z":"f6f2187d.f17ca8","name":"Clean contexts","func":"global.set('pyodide', undefined, \"memory\");\nglobal.set('pythonLibraries', undefined, \"memory\");\nglobal.set('mlModels', undefined, \"memory\");\nreturn msg;","outputs":0,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":300,"y":300,"wires":[]},{"id":"13a3582cf7019e87","type":"comment","z":"f6f2187d.f17ca8","name":"Clean global context","info":"","x":110,"y":260,"wires":[]},{"id":"6346b608.d007a8","type":"mqtt-broker","name":"OSI4IOT_MQTT_8883","broker":"mosquitto","port":"8883","tls":"b278b10.69bfb5","clientid":"MQTT_CLIENT_ID","autoConnect":true,"usetls":true,"compatmode":false,"protocolVersion":"4","keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","birthMsg":{},"closeTopic":"","closeQos":"0","closePayload":"","closeMsg":{},"willTopic":"","willQos":"0","willPayload":"","willMsg":{},"sessionExpiry":""},{"id":"b278b10.69bfb5","type":"tls-config","name":"","cert":"/data/certs/client.crt","key":"/data/certs/client.key","ca":"/data/certs/ca.crt","certname":"","keyname":"","caname":"","servername":"","verifyservercert":false,"alpnprotocol":""}]